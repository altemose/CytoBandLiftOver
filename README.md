# README for HG002 CytoBand Track and LiftOver code
- This provides a track with the rough coordinates of cytobands from Giemsa-stained chromosomes.
- This track should only be taken as a rough guide, based on iterative rounds of liftover between genome assemblies plus heuristic steps for highly repetitive regions.
- The original cytoband tracks were generated by Furey & Haussler 2003 (PMID: 12700172) and Cheung et al. 2001 (PMID: 11237021), which used a FISH-mapped BAC library (https://www.ncbi.nlm.nih.gov/genome/cyto/hbrc.shtml) aligned to the reference sequence to determine the approximate positions of chromosome bands. These were lifted over by the UCSC Genome Browser team to hg38.
- For the T2T-chm13v2.0 reference sequence (Nurk et al. 2022, PMID: 35357919), the hg38 cytoband track was lifted over using liftOver then semi-manually corrected.
- Here, I lifted over the T2T-chm13v2.0 cytoband track to the hg002v1.1.mat and hg002v1.1.pat haplotype assemblies separately, then used annotations of peri/centromeric satellites and rDNAs to adjust centromere and rDNA stalk coordinates.
- The final output files are hg002v1.1.mat_cytoBandMapped.bed and hg002v1.1.pat_cytoBandMapped.bed.

## Written description of method
The T2T-chm13v2.0 (hs1) cytoBandMapped track file was obtained at https://hgdownload.soe.ucsc.edu/gbdb/hs1/cytoBandMapped/ and converted to bed format. Cytoband coordinates were first lifted over to hg002v1.1.mat and hg002v1.1.pat separately using chain files CHM13v2.0_to_hg002v1.1.mat.chain and CHM13v2.0_to_hg002v1.1.mat.chain, obtained from https://s3-us-west-2.amazonaws.com/human-pangenomics/index.html?prefix=T2T/HG002/assemblies/changes/. The CenSat annotation track was obtained from https://github.com/hloucks/CenSatData/tree/main/HG002/v1.1. The reference sequence fasta index files hg002v1.1.mat.fasta.gz.fai and hg002v1.1.pat.fasta.gz.fai, which indicate chromosome names and lengths, were obtained from https://s3-us-west-2.amazonaws.com/human-pangenomics/T2T/HG002/assemblies/. 
A perl script (Refine_CytoBand_Liftover_v1.0.pl) was generated to extract centromere, telomere, rDNA, and heterochromatin boundary information from the CenSat track and fasta index files, then to use this information to adjust the boundaries of these regions in the lifted over cytoband tracks, as follows:
- Centromere band boundaries were placed at the most distal ends of the “active_hor” array annotation (or split HOR arrays, e.g. on chr3 and 4) on each chromosome.
- The p->q transition was placed at the midpoint between these centromere band boundaries. - Centromere-adjacent band coordinates were adjusted to be contiguous.
- The last band on each chromosome was adjusted to have its end position match the chromosome end position, and the first band on each chromosome was adjusted to start at 0. - rDNA stalk band coordinates were adjusted to match the boundaries of the rDNA arrays.
- The 1q12, 9q12, and Yq12 boundaries were adjusted to the ends of the large HSat2/3 arrays in those regions, and adjacent band coordinates were adjusted accordingly. 
- 9p13.1 was adjusted to have a fixed length of 1.1 Mb, and 9p12 was adjusted to have a fixed length of 1 Mb. 
- For any remaining bands with boundaries that failed to lift over, their coordinates were fixed to preserve the relative sizes of that band and its neighboring bands relative to their sizes in T2T-chm13v2.0.
- Any gaps between adjacent bands were adjusted to make bands contiguous by moving the boundary to restore band sizes closer to the sizes in T2T-chm13v2.0.
- For validation, band sizes were confirmed to be roughly preserved after liftover (apart from centromeres, rDNAs, and their adjacent bands), and adjacent band coordinates were checked to be contiguous.

## Refine_CytoBand_Liftover_v1.0.pl usage
```
perl Refine_Cytoband_Liftover_v1.0.pl /path/to/chm13v2.0_cytobands_allchrs.bed /path/to/NewAssembly_CytoBands_LiftedOver.bed /path/to/NewAssembly_CenSat_Track.bed  /path/to/NewAssembly_faidxfile.fai /path/to/outputfile.bed
```
- See COMMANDS_HG002_CytoBandLiftover.txt for the full list of bash commands (on a Mac OSX terminal) to download primary input files and regenerate the output tracks. Input files are also available in InputFiles.zip in this repository.
- Primary output files are hg002v1.1.mat_cytoBandMapped.bed and hg002v1.1.pat_cytoBandMapped.bed.
- Supplementary output files are in IssuesAndQC.zip, which identify bands that required special heuristic steps (*ISSUES.txt) and compare lifted over bands to T2T-chm13v2.0 for QC purposes (*QC.txt). QC supplementary columns are:
- CHM13 band length
- Lifted over band length in new assembly
- Absolute value of difference in length from chm13
- Absolute percent difference in length from chm13
- Gap length in new assembly between current band and previous band

## Additional caveats
- The script Refine_CytoBand_Liftover_v1.0.pl uses many heuristic steps to provide approximate but complete cytoband coordinates. 
- While this was tailored for T2T-chm13v2.0 to hg002v1.1 conversion, in theory, it should work for lifting over T2T-chm13v2.0 cytobands to other karyotypically 'normal' human genome assemblies. However, it may not work well on
edge cases in other assemblies.
- It expects the new assembly's chromosome nomenclature to be of the form chrN_*
- Future work should improve the annotation of cytobands either by using the original FISH-mapped BAC data, or by using primary genome features that strongly predict Giemsa staining.

